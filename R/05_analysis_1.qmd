---
title: "Principal component analysis"
format:
  html:
    output_dir: "../results/"
editor: visual
---

## Principal component analysis (PCA):

load libraries:

```{r}
#| message: false 
library(readr)
library(tidyverse)
library(broom)
library(cowplot)
library(dplyr)
library(tidyr)

```

load data:

```{r}
data <- read_tsv("../data/03_dat_aug.tsv")
data <- data |>
  column_to_rownames(var = "ID_REF")
```

```{r}
# Handle missing data (if any)
cleaned_data <- data |>
  select(ends_with("_at"))|>
  mutate(across(where(is.numeric), ~ ifelse(is.na(.), mean(., na.rm = TRUE), .)))

# Perform PCA
pca <- prcomp(cleaned_data, scale = TRUE)

#save pca scores:
pca_scores <- pca$x
pca_scores_tbl <- as_tibble(pca_scores)

pca.var <- pca$sdev^2
pca.var.percent <- round(pca.var/sum(pca.var)*100, digits = 2)


```

```{r}
#generate PCA plot
pca_plot <- ggplot(pca_scores_tbl, aes(x = PC1, y = PC2)) +
  geom_point() +  # Scatter plot
  geom_text(label = rownames(data)) +
  labs(x = str_c('PC1: ', pca.var.percent[1], ' %'), 
       y = str_c('PC2: ', pca.var.percent[2], ' %'), 
       title = "Principal component analysis (PCA)") +
  theme_minimal()
#save pca plot
pca_plot |> 
  ggsave(filename = "05_pca.png",
         path =  "../results/")
```
