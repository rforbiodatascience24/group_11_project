---
title: "Group 11 - Gene expression in colorectal cancer"
author: "Eleni-Sofia Tseperi (s240066),	Johanne Lund	(s233246), Marie Picquet	(s233736), Eglantine Anton	(s233242), Qiuyan Wu	(s241063)"
format:
  revealjs:
    code-line-numbers: true
    scrollable: true
    smaller: true
    scoll: true
    theme: night
    transition: slide
    incremental: true 
editor: visual
---

```{r}
library(tidyverse)
library(here)
library(readr)
library(broom)
library(here)
library(ggrepel)
```

## Introduction

-   Background

    -   Colorectal cancer (CRC) is a major cause of cancer mortality

    -   Gene expression analysis can help identify dysregulated genes

-   Goal of the project

    -   Investigate xxx

    -   Model xxx

-   Data sets

    -   Gene expression level for 1935 genes

    -   Patient information for 62 patients

    -   Artificially made dirty and messy to increase the difficulty of the projects

## Methods overview

(incl run-all file), raw, load, making dirty

## Methods - Tidy, clean & augment

### Tidy

::: columns
::: {.column width="50%"}
Expression data

-   The columns represent observations and the rows variables
    -   Pivot the data set
:::

::: {.column width="50%"}
Patient data

-   `DFS event/Adj_Radio/Adj_Chem` contains 3 variables

    -   Separate it into 3 distinct variables

-   Observations of column `DFS (in years and months)` contains two values

    -   Convert into months to have only value per observation
:::
:::

### Clean

Combine the two data sets by joining on the patient ID.

-   Missing values "N/A" and "NA"

    -   Load everything as NA when opening the file

-   Gender as "Male", "M", "Female", "F"

    -   Convert M to Male and F to Female

-   One patient has an Age \< 0

    -   Substitute it by the mean value of the age of the other observations

-   Long column names with several words

    -   Remove "gene\_" at the beginning of all the gene names

    -   Remove the units from the names

    -   Replace spaces by \_

### Augment

-   Create an age group variable

-   Create a metastasis variable

    -   Duke stage A, B, C don't involve metastasis

    -   Duke stage D involve metastasis

## Methods - Describe

## Results - Data description

## Methods - Analysis 1

## Methods - Analysis 2

### Aim

Identify genes that are significantly up- or down-regulated between the patients with/without metastasis

::: columns
::: {.column width="50%"}
1.  Pivot the data
2.  Group per gene and nest the data
3.  Fit a linear model per gene
4.  Tidy the fitted model and get confidence intervals
5.  Extract the model parameters and correct for multiple testing
:::

::: {.column width="50%"}
```{r}
#| eval: false
data_long_nested <- data |>
  select(ends_with("_at"), metastasis) |> 
  pivot_longer(cols = ends_with("_at"), 
               names_to = "gene", 
               values_to = "log2_expr_level") |> 
  group_by(gene) |> 
  nest() |> 
  ungroup()

data_long_nested <- data_long_nested |> 
  group_by(gene) |> 
  mutate(model_object = map(.x = data,
                   .f = ~lm(formula = log2_expr_level ~ metastasis,
                            data = .x))) |> 
  ungroup() |> 
  mutate(model_object_tidy = map(.x = model_object,
                                 .f = ~tidy(x =.x,
                                            conf.int = TRUE,
                                            conf.level = 0.95)))

estimates <- data_long_nested |> 
  unnest(model_object_tidy) |> 
  filter(term == "metastasis") |> 
  select("gene", "p.value", "estimate", "conf.low", "conf.high") |> 
  mutate(q.value = p.adjust(p.value),
         is_significant = case_when(q.value > 0.05 ~ "no",
                                    q.value <= 0.05 ~ "yes"))

```
:::
:::

## Methods - Analysis 3

## Results - Analysis 1 & 2

::: columns
::: {.column width="50%"}
Analysis 1
:::

::: {.column width="50%"}
Analysis 2

-   No gene found to be signicant after multiple testing

-   Use the genes with p\<0.01 for the plot

-   20 genes (12 up regulated, 8 down regulated)

![](images/06_analysis_volcano-01.png)
:::
:::

## Results analysis 3 & Discussion
